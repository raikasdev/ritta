<!DOCTYPE html>
<html lang="fi">
   <head>
      <meta charset="UTF-8">
      <meta content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" name="viewport">
      <title>Ritta &mdash; Lähetä viesti</title>
      <!-- General CSS Files -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
      <!-- CSS Libraries -->
      <link rel="stylesheet" href="/jqvmap/dist/jqvmap.min.css">
      <link rel="stylesheet" href="/summernote/dist/summernote-bs4.css">
      <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
      <!-- Template CSS -->
      <link rel="stylesheet" href="/css/style.css">
      <link rel="stylesheet" href="/css/custom.css">
      <link rel="stylesheet" href="/css/components.css">
   </head>
   <body>
      <div id="app">
         <div class="main-wrapper">
            <%- include ('partials/navbar', {lang: lang, user: user, username: username, school: school, pageid: "homepage"}) -%>
            <!-- Main Content -->
            <div class="main-content">
               <section class="section">
                  <div class="section-header">
                     <h1>Ritta</h1>
                  </div>
                  <form method="POST" action="/messages/send" autocomplete="off" autocapitalize="on">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <div class="autocomplete" style="width:300px;">
                        <input type="text" id="vastaanottaja" name="vastaanottaja" required placeholder="Vastaanottaja">
                      </div>
                      <div id="editor" style="height: 300px;background-color:white;color:black;">
                      </div>
                     <textarea style="display: none" id="message" name="message" readonly></textarea>
                     <input type="submit" value="Lähetä viesti">
                  </form>
               </section>
            </div>
            <%- include("partials/footer", {version: version}) -%>
         </div>
      </div>
      <!-- General JS Scripts -->
      <script src="/js/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
      <script src="/js/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
      <script src="/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      <script src="/js/jquery.nicescroll.min.js"></script>
      <script src="/js/moment.min.js"></script>
      <script src="/js/stisla.js"></script>
      <script defer src="/js/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
      <!-- JS Libraies -->
      <script src="/jquery-sparkline/jquery.sparkline.min.js"></script>
      <script src="/chart.js/dist/Chart.min.js"></script>
      <script src="/summernote/dist/summernote-bs4.js"></script>
      <script src="/chocolat/dist/js/jquery.chocolat.min.js"></script>
      <script src="/js/quill.js"></script>
      <script src="/js/quilljs-markdown.js"></script>
      <script src="/js/showdown.min.js"></script>

      <!-- Template JS File -->
      <script src="/js/scripts.js"></script>
      <script src="/js/custom.js"></script>

      <script>
         var autocomplete_users = ["opiskelija.ritta","opettaja.ritta","henkilokunta.ritta"];
         autocomplete(document.getElementById("vastaanottaja"), autocomplete_users);
         
         
         (function($){
         let email = "";
         
         $.fn.email_multiple = function(options) {
         
             let defaults = {
                 reset: false,
                 fill: false,
                 data: null
             };
         
             let settings = $.extend(defaults, options);
             
         
             return this.each(function()
             {
                 $(this).after("<span class=\"to-input\">Vastaanottajat:</span><br>\n" +
                     "<div class=\"all-mail\"></div><br><br>\n" +
                     "<input type=\"text\" name=\"email\" class=\"enter-mail-id no-submit\" placeholder=\"Syötä vastaanottaja\" id=\"vastaanottajainput\"/>");
                  
                 let $orig = $(this);
                 let $element = $('.enter-mail-id');
                 $element.keydown(function (e) {
                     $element.css('border', '');
                     if (e.keyCode === 13 || e.keyCode === 32) {
                         let getValue = $element.val();
                         if(getValue === "") return;
                         $('.all-mail').append('<span class="email-ids">' + getValue + '<span class="cancel-email">x</span></span>');
                         $element.val('');
         
                         email += getValue + ';'
                     }
         
                     $orig.val(email.slice(0, -1))
                 });
         
                 $(document).on('click','.cancel-email',function(){
                     $(this).parent().remove();
                 });
         
                 if(settings.data){
                     $.each(settings.data, function (x, y) {
                         if (/^[a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,6}$/.test(y)){
                             $('.all-mail').append('<span class="email-ids">' + y + '<span class="cancel-email">x</span></span>');
                             $element.val('');
         
                             email += y + ';'
                         } else {
                             $element.css('border', '1px solid red')
                         }
                     })
         
                     $orig.val(email.slice(0, -1))
                 }
         
                 if(settings.reset){
                     $('.email-ids').remove()
                 }
         
                 return $orig.hide()
             });
         };
         
         })(jQuery);
         
         $("form").submit(function() {
         $(this).children('.no-submit').remove();
         });
         
         $(document).ready(function($){
         /*$(".multiemail").email_multiple({
         });*/
         });
         
         $(document).on("keypress", 'form', function (e) {
         var code = e.keyCode || e.which;
         if (code == 13) {
             e.preventDefault();
             return false;
         }
         });
         
         </script>
      <!-- Page Specific JS File -->
      <script src="/js/page/index.js"></script>
      <script>
         localStorage.setItem("software", "Ritta");
         var quill = new Quill('#editor', {
             modules: {
                 toolbar: [
                 ['bold', 'italic', 'underline', 'strike', 'clean'],
                 ['image', 'blockquote', 'code-block'],
                 [{ 'script': 'sub'}, { 'script': 'super' }],
                 [{ 'indent': '-1'},{ 'align': [] },{ 'indent': '+1'}],
                 [{ 'header': [1, 2, 3, 4, 5, 6, false] },{font: []}],
                 [{ 'color': [] }, { 'background': [] }],
                 [{ 'list': 'ordered'}, { 'list': 'bullet' }]
                 ]
             },
             theme: 'snow'  // or 'bubble'
         });
         quill.on('text-change', function(delta, oldDelta, source) {
            let v = quill.container.firstChild.innerHTML;
            $('#message').val(v);
         });
         new QuillMarkdown(quill);
      </script>
   </body>
</html>